/*
 *  jQuery Coverrr - v0.1
 *  Bring CSS background-image to life.
 *  https://github.com/omulet/jquery-coverrr
 *
 *  Made by Bogdan Silivestru
 *  Under MIT License
 */
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};!function(b,c,d){var e,f,g,h,i;return h="coverrr",f={duration:20,direction:"alternate",delay:0,timingFunction:"ease-in-out",iterationCount:"infinite"},i={animation:!1,transform:!1,animation_string:"animation",transform_string:"transform",prefix:""},e=function(){function e(c,d){this.el=c,this.init=a(this.init,this),this.settings=b.extend({},f,d),this._defaults=f,this._name=h,this._el=b(this.el),this.oldSize=[0,0],this.cover=b("<img>"),this.img={src:this.getImageSrc(),w:0,h:0,ratio:0},i.animation===!0?this.getBg().then(this.init):console.log("Your browser does not support CSS animations. "+h+" won't run this time")}return e.prototype.init=function(){return this.convertBgToCover(),this.update(),b(c).smartresize(function(a){return function(){return a._el.outerWidth()!==a.oldSize[0]||a._el.outerHeight()!==a.oldSize[1]?a.update():void 0}}(this))},e.prototype.convertBgToCover=function(){var a;return a=this._el.css("position"),"static"===a&&(a="relative"),this._el.css({overflow:"hidden","background-image":"none",position:a}),this.cover.attr("src",this.img.src),this.cover.css({top:0,left:0,position:"absolute","z-index":-1}),this.cover.prependTo(this._el)},e.prototype.update=function(){var a,b,c,e,f;return this.id=(65536*(1+Math.random())|0).toString(16).substring(1),c=[this._el.outerWidth(),this._el.outerHeight()],this.oldSize=c,b=c[0]/c[1],this.cover[0].style[i.animation_string]="coverrr"+this.id+" "+this.settings.duration+"s "+this.settings.timingFunction+" "+this.settings.delay+"s "+this.settings.iterationCount+" "+this.settings.direction,b>this.img.ratio?(a=Math.round(c[1]-c[0]*this.img.h/this.img.w),this.cover.css({width:c[0]+"px",height:"auto"}),e="@"+i.prefix+"keyframes coverrr"+this.id+" { from {"+i.prefix+"transform:translateY( 0 ) }to {"+i.prefix+"transform:translateY( "+a+"px ) }}"):(a=Math.round(c[0]-c[1]*this.img.w/this.img.h),this.cover.css({width:"auto",height:c[1]+"px"}),e="@"+i.prefix+"keyframes coverrr"+this.id+" { from {"+i.prefix+"transform:translateX( 0 ) }to {"+i.prefix+"transform:translateX( "+a+"px ) }}"),d.styleSheets&&d.styleSheets.length?d.styleSheets[0].insertRule(e,0):(f=d.createElement("style"),f.innerHTML=e,d.getElementsByTagName("head")[0].appendChild(f))},e.prototype.getImageSrc=function(){var a;return a=b(this.el).css("background-image"),a.replace(/url\((['"])?(.*?)\1\)/gi,"$2").split(",")[0]},e.prototype.getBg=function(){var a;return a=b.Deferred(),this.loadImage(this.img.src).done(function(b){return function(c){return b.img.w=c.width,b.img.h=c.height,b.img.ratio=c.width/c.height,a.resolve()}}(this)),a.promise()},e.prototype.loadImage=function(a){return b.Deferred(function(b){var c;c=new Image,c.onload=function(){b.resolve(c)},c.onerror=function(){b.reject()},c.src=a}).promise()},e}(),(g=function(){var a,b,c,e;if(e="Webkit Moz O ms Khtml".split(" "),a=d.createElement("p"),d.body.insertBefore(a,null),a.style.animationName&&(i.animation=!0),a.style.transform&&(i.transform=!0),i.animation===!1)for(b=0;b<e.length;){if(void 0!==a.style[e[b]+"AnimationName"]){c=e[b],i.animation_string=c+"Animation",i.prefix="-"+c.toLowerCase()+"-",i.animation=!0;break}b++}if(i.transform===!1)for(b=0;b<e.length;){if(void 0!==a.style[e[b]+"Transform"]){c=e[b],i.transform_string=c+"Transform",i.animation=!0;break}b++}return d.body.removeChild(a)})(),b.fn[h]=function(a){var c,d;return this.each(function(){return b.data(this,"plugin_"+h)?void 0:b.data(this,"plugin_"+h,new e(this,a))}),c=function(a,b,c){var d,e;return e=void 0,d=function(){var d,f,g;f=function(){c||a.apply(g,d),e=null},g=this,d=arguments,e?clearTimeout(e):c&&a.apply(g,d),e=setTimeout(f,b||200)}},d="smartresize",b.fn[d]=function(a){return a?this.bind("resize",c(a)):this.trigger(d)}}}(jQuery,window,document)}).call(this);